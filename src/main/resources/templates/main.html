<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">

    <div id="carouselAutoplaying" class="carousel slide w-75 m-auto" data-bs-ride="carousel" data-bs-pause="false">
        <h1>인기 영화</h1>
        <div class="carousel-indicators">
            <button
                    type="button"
                    th:each="i : ${#numbers.sequence(0, 19)}"
                    th:data-bs-slide-to="${i}"
                    th:classappend="${i == 0} ? 'active'"
                    data-bs-target="#carouselAutoplaying"
                    aria-label="Slide [[${i + 1}]]">
            </button>
        </div>

        <div class="carousel-inner">
            <div class="carousel-item" th:each="movie, iterStat : ${trendingList}" th:classappend="${iterStat.index == 0} ? 'active'" data-bs-interval="3000">
                <a th:href="@{/detail/{id}(id=${movie.movieID})}">
                    <img th:src="|https://image.tmdb.org/t/p/original${movie.backdrop_path}|" class="card-img-top" alt="Movie Poster">
                </a>

                <!-- Rating badge in the upper-right corner -->
                <div class="position-absolute top-0 end-0 p-3">
                    <span class="badge text-white fs-3" style="background-color: rgba(0, 0, 0, 0.6);">⭐[[${movie.rating}]]</span>
                </div>

                <div class="carousel-caption d-none d-md-block">
                    <a th:href="@{/detail/{id}(id=${movie.movieID})}" style="text-decoration: none;">
                        <h3 style="background-color: rgba(0, 0, 0, 0.6); color: #fff; padding: 10px;">[[${movie.title}]]</h3>
                    </a>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselAutoplaying" data-bs-slide="prev">
            <span class="carousel-control-prev-icon p-4" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselAutoplaying" data-bs-slide="next">
            <span class="carousel-control-next-icon p-4" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    <br>
    <h2>다은님에게 추천</h2>
    <div class="d-flex overflow-auto gap-1">
        <div th:each="movie : ${recommendedList}"
             class="card mb-3 bg-transparent text-white rounded-0 border-0"
             style="flex: 0 0 auto; width: 300px; height: auto;">
            <!-- Dynamically set the image source -->
            <a th:href="@{/detail/{id}(id=${movie.movieID})}">
                <img th:src="${movie.backdrop_path}"
                     class="card-img-top rounded-0"
                     alt="Movie Poster"
                     style="object-fit: cover; height: 168px;">
            </a>
            <div class="card-body p-1" style="height: 30px; overflow: hidden;">
                <!-- Display movie title -->
                <p class="text-center">[[${movie.title}]]</p>
            </div>
        </div>
    </div>

    <br>
    <h2>나의 관심 리스트</h2>
    <div class="d-flex overflow-auto gap-1">
        <div th:each="movie : ${watchList}"
             class="card mb-3 bg-transparent text-white rounded-0 border-0"
             style="flex: 0 0 auto; width: 300px; height: auto;">
            <!-- Dynamically set the image source -->
            <a th:href="@{/detail/{id}(id=${movie.movieApiId})}">
                <img th:src="${movie.backdropPath}"
                     class="card-img-top rounded-0"
                     alt="Movie image"
                     style="object-fit: cover; height: 168px;">
            </a>
            <div class="card-body p-1" style="height: 30px; overflow: hidden;">
                <!-- Display movie title -->
                <p class="text-center">[[${movie.title}]]</p>
            </div>
        </div>
    </div>
</div>
<div th:text="${showGenreModal}"></div>

<!-- Genre Selection Modal -->
<div class="modal fade" id="genreModal" tabindex="-1" aria-labelledby="genreModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="genreModalLabel">🎥 좋아하는 장르 3개를 선택하세요!</h5>
            </div>
            <div class="modal-body">
                <div id="genre-options" class="d-flex flex-wrap">
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="28">액션</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="12">모험</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="16">애니메이션</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="35">코미디</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="80">범죄</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="99">다큐멘터리</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="18">드라마</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="10751">가족</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="14">판타지</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="36">역사</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="27">공포</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="10402">음악</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="9648">미스터리</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="10749">로맨스</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="878">SF</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="10770">TV 영화</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="53">스릴러</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="10752">전쟁</button>
                    <button class="btn btn-outline-primary m-1 genre-btn" data-genre="37">서부</button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-genres-btn" class="btn btn-primary">저장</button>
            </div>
        </div>
    </div>

</div>
<div th:text="${showGenreModal}"></div>
</html>