<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ìƒì„¸</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* ì¢‹ì•„ìš” ë²„íŠ¼ì„ ì˜¤ë¥¸ìª½ í•˜ë‹¨ì— ìœ„ì¹˜ì‹œí‚¤ëŠ” ìŠ¤íƒ€ì¼ */
        .comment-container {
            position: relative;
            margin-bottom: 10px;
        }
        .like-button {
            position: absolute;
            bottom: 10px;
            right: 50px;
        }

        .like-cnt {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }

        .reply-form {
            margin-top: 15px;
            margin-left: 20px;
            display: none;
        }

        .reply-button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
<div class="p-5 mb-5 text-center bg-light">
    <h1 class="mb-3">ê²Œì‹œê¸€ ìƒì„¸</h1>
</div>

<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow-sm">
                <div class="card-header">
                    <h4>ì‘ì„±ì: <span th:text="${article.writer}">ìµëª…</span></span></h4>
                    <h6>ì¡°íšŒìˆ˜: <span th:text="${article.views}"></span></h6>
                </div>
                <div class="card-body">
                    <h5 class="card-title" th:text="${article.title}">ì œëª©</h5>
                    <p class="card-text" th:text="${article.content}">ë‚´ìš©</p>
                    <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
                    <div class="card mt-3">
                        <div class="card-header">
                            <h5>ëŒ“ê¸€</h5>
                        </div>
                        <div class="card-body">
                            <div th:each="comment : ${comments}" class="comment-container">
                                <p>
                                    <strong th:text="${comment.user.nickname}">ì‘ì„±ì</strong>:
                                    <span th:id="'commentContent_' + ${comment.id}" th:text="${comment.content}">ëŒ“ê¸€ ë‚´ìš©</span>
                                </p>
                                <div th:if="${comment.user.id == 7}">
                                    <button type="button" class="btn btn-primary btn-sm" style="display: none;" onclick="saveComment('[[${comment.id}]]')">ì €ì¥</button>
                                    <button type="button" class="btn btn-secondary btn-sm" style="display: none;" onclick="cancelEdit('[[${comment.id}]]')">ì·¨ì†Œ</button>
                                    <button type="button" class="btn btn-primary btn-sm" th:onclick="editComment(this, '[[${comment.id}]]','[[${comment.content}]]')">ìˆ˜ì •</button>
                                    <button type="button" class="btn btn-sm btn-danger" th:onclick="deleteComment('[[${comment.id}]]')">ì‚­ì œ</button>
                                </div>
                                <!-- ì¢‹ì•„ìš” ë²„íŠ¼ê³¼ ì¢‹ì•„ìš” ìˆ˜ -->
                                <div style="display: inline-flex; align-items: center;">
                                    <span id="likeCount_[[${comment.id}]]" class="mr-2 like-cnt">[[${comment.reactions.size()}]]</span>
                                    <button type="button" class="btn btn-success btn-sm like-button" th:onclick="likeComment('[[${comment.id}]]')">ğŸ‘ ì¢‹ì•„ìš”</button>
                                </div>

                                <!-- ëŒ€ëŒ“ê¸€ ë‹¬ê¸° ë²„íŠ¼ -->
                                <div class="reply-button">
                                    <button type="button" class="btn btn-sm btn-info" th:onclick="toggleReplyForm('[[${comment.id}]]')">ë‹µê¸€ ë‹¬ê¸°</button>
                                </div>

                                <!-- ëŒ€ëŒ“ê¸€ í‘œì‹œ -->
                                <div th:each="reply : ${comment.replies}" class="ml-4 mt-2">
                                    <p>
                                        <strong th:text="${reply.user.nickname}">ì‘ì„±ì</strong>:
                                        <span th:id="'commentContent_' + ${reply.id}" th:text="${reply.content}">ëŒ€ëŒ“ê¸€ ë‚´ìš©</span>
                                    </p>
                                    <!-- ëŒ€ëŒ“ê¸€ ìˆ˜ì •, ì‚­ì œ -->
                                    <div th:if="${reply.user.id == 7}">
                                        <button type="button" class="btn btn-primary btn-sm" th:onclick="editComment(this, '[[${reply.id}]]','[[${reply.content}]]')">ìˆ˜ì •</button>
                                        <button type="button" class="btn btn-sm btn-danger" th:onclick="deleteComment('[[${reply.id}]]')">ì‚­ì œ</button>
                                    </div>
                                </div>

                                <!-- ëŒ€ëŒ“ê¸€ ì…ë ¥ í¼ (í† ê¸€ë¡œ ë³´ì´ê±°ë‚˜ ìˆ¨ê¸°ê¸°) -->
                                <!--div id="replyForm_${comment.id}" class="reply-form"-->
                                <div th:id="'replyForm_'+${comment.id}" class="reply-form">
                                    <form th:action="@{|/comments/reply/${article.id}/${comment.id}|}" method="post">
                                        <div class="form-group">
                                            <textarea name="content" class="form-control" rows="3" placeholder="ëŒ€ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-sm">ëŒ€ëŒ“ê¸€ ë“±ë¡</button>
                                        <button type="button" class="btn btn-secondary btn-sm" th:onclick="toggleReplyForm('[[${comment.id}]]')">ì·¨ì†Œ</button>
                                    </form>
                                </div>
                                <hr>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card-footer">
                    <div class="d-flex justify-content-between align-items-center">
                        <!-- ì¶”ì²œ/ë¹„ì¶”ì²œ ìˆ˜ -->
                        <div>
                            <span>ğŸ‘ ì¶”ì²œ: <span th:text="${article.likes}">0</span></span>
                            <span>ğŸ‘ ë¹„ì¶”ì²œ: <span th:text="${article.dislikes}">0</span></span>
                        </div>
                        <!-- ì¶”ì²œ/ë¹„ì¶”ì²œ ë²„íŠ¼ -->
                        <div class="reaction-buttons">
                            <!-- ì¶”ì²œ ë²„íŠ¼ -->
                            <button type="button" class="btn btn-success btn-sm"
                                    th:onclick="|reactToPost(${article.id}, 'LIKE')|">
                                ğŸ‘ ì¶”ì²œ
                            </button>

                            <!-- ë¹„ì¶”ì²œ ë²„íŠ¼ -->
                            <button type="button" class="btn btn-danger btn-sm"
                                    th:onclick="|reactToPost(${article.id}, 'DISLIKE')|">
                                ğŸ‘ ë¹„ì¶”ì²œ
                            </button>


                        </div>
                    </div>
                    <hr>
                    <!-- ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ (ì‘ì„±ìë§Œ ë³´ì„) -->
<!--                    <div th:if="${isOwner}">-->

                        <!-- ìˆ˜ì • ë²„íŠ¼ -->
                        <button type="button" class="btn btn-primary btn-sm"
                                th:onclick="|location.href='@{/community/new?id={articleId}(articleId=${article.id})}'|">
                            ìˆ˜ì •
                        </button>
                        <!-- ì‚­ì œ ë²„íŠ¼ -->
                        <input type="hidden" id="article-id" th:value="${article.id}" />
                        <button type="button" class="btn btn-danger btn-sm" onclick="deleteArticle()">ì‚­ì œ</button>
<!--                    </div>-->

                    <!-- ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° -->
                    <button type="button" class="btn btn-secondary btn-sm" onclick="location.href='/community/list'">ëª©ë¡</button>
                </div>


                <!-- ë‹µë³€ ì‘ì„± í¼ -->
                <form th:action="@{|/comments/create/${article.id}|}" method="post">
                    <div class="form-group">
                        <textarea name="content" class="form-control" rows="5" placeholder="ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">ëŒ“ê¸€ ë“±ë¡</button>
                </form>

            </div>
        </div>
    </div>
</div>


<script src="/js/comment.js"></script>
<script src="/js/token.js"></script>
<script src="/js/article.js"></script>
</body>
</html>
